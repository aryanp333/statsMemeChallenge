---
title: "Selection Bias & Missing Data Challenge - Part 2"
subtitle: "Creating a Statistics Meme: Visualizing Selection Bias"
author: "Aryan Pagdaloo"
format:
  html: default
execute:
  echo: true
  eval: true
---

# ðŸŽ¨ Selection Bias & Missing Data Challenge - Part 2

## The Problem: Visualizing Selection Bias

Selection bias occurs when observed data isn't representative of the population. Your meme will show:

- **Reality**: Your original image (truth)
- **Your Model**: Your stippled image (representation)
- **Selection Bias**: A bold letter "S" (systematic missing data pattern)
- **Estimate**: Stippled image with "S" mask applied (biased estimate)

**Key Concept:** Images are simply matricesâ€”2D arrays where each value represents a pixel (0.0 = black, 1.0 = white). Your stippled image is a matrix with black dots (data points) on a white background. Selection bias removes some of these pixels (data points) in a systematic pattern (the "S"), creating a biased estimate. You'll use image composition tools (matplotlib in Python, imager in R) to arrange these matrices into a memorable visualization.

## Why This Matters

This exercise is fundamentally about **walking AI through a process** to create valuable output. You're not just codingâ€”you're collaborating with AI to transform abstract statistical concepts into a memorable visual artifact. The meme you create will serve as a mental anchor: whenever you think about selection bias in the future, you'll ask yourself: **"Does my sample match my population of interest?"** This visualization will stick with you for the rest of your life, making it easier to recognize and address selection bias in real-world data analysis.

## The Statistics Meme

The four-panel statistics meme demonstrates selection bias through visualization:

![Four-panel statistics meme showing Reality (original image), Your Model (stippled version), Selection Bias (letter S), and Estimate (masked stippled image)](statistics_meme_result.png)

*The meme was generated using the code in this document (code is hidden in the final HTML output for a clean presentation).*

```{python}
#| label: generate-meme
#| echo: false
#| eval: false
#| 
# Note: The meme has been pre-generated using generate_meme.py
# Code is included for reference but not executed (echo: false ensures code is hidden in HTML)

import numpy as np
from PIL import Image, ImageDraw, ImageFont
import matplotlib.pyplot as plt
import os

# Step 1: Load images
# Try common file names - adjust these to match your Part 1 files
image_files = [
    'E1311F60-BC46-4A56-8902-8DBC1E9AF295_4_5005_c copy.jpeg',  # Your image
    'E1311F60-BC46-4A56-8902-8DBC1E9AF295_4_5005_c.jpeg',
    'original_image.jpg', 'original_image.jpeg', 'original_image.png',
    'image.jpg', 'image.jpeg', 'image.png'
]

stipple_files = [
    'stippleImage.npy', 'stipple.npy', 'stippled_image.npy'
]

# Find and load original image
original_array = None
for img_file in image_files:
    if os.path.exists(img_file):
        original_img = Image.open(img_file)
        if original_img.mode != 'L':
            original_img = original_img.convert('L')
        original_array = np.array(original_img, dtype=np.float32) / 255.0
        print(f"Loaded original image: {img_file}, shape: {original_array.shape}")
        break

if original_array is None:
    raise FileNotFoundError("Could not find original image. Please ensure your image file is in the repository.")

# Find and load stippled image
stipple_array = None
for stipple_file in stipple_files:
    if os.path.exists(stipple_file):
        stipple_array = np.load(stipple_file)
        print(f"Loaded stippled image: {stipple_file}, shape: {stipple_array.shape}")
        break

if stipple_array is None:
    raise FileNotFoundError(
        "Could not find stippled image (.npy file).\n"
        "Please run 'python3 generate_stippled.py' to generate the stippled image first,\n"
        "or ensure your stippled image from Part 1 is saved as stippleImage.npy"
    )

# Ensure both arrays have the same dimensions
if original_array.shape != stipple_array.shape:
    # Resize stipple to match original if needed
    from PIL import Image as PILImage
    stipple_img = PILImage.fromarray((stipple_array * 255).astype(np.uint8))
    stipple_img = stipple_img.resize((original_array.shape[1], original_array.shape[0]), PILImage.LANCZOS)
    stipple_array = np.array(stipple_img, dtype=np.float32) / 255.0
    print(f"Resized stipple to match original: {stipple_array.shape}")

height, width = original_array.shape

# Step 2: Create the block letter "S"
# Create white background
s_image = Image.new('L', (width, height), 255)
draw = ImageDraw.Draw(s_image)

# Try to use a bold font, fallback to default if not available
font_size = int(height * 0.85)  # 85% of image height
font = None

# Try different font paths for bold fonts (macOS, Linux, Windows)
font_paths = [
    '/System/Library/Fonts/Supplemental/Arial Bold.ttf',
    '/System/Library/Fonts/Helvetica Bold.ttf',
    '/Library/Fonts/Arial Bold.ttf',
    '/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf',
    '/usr/share/fonts/truetype/liberation/LiberationSans-Bold.ttf',
    '/Windows/Fonts/arialbd.ttf',
    '/Windows/Fonts/calibrib.ttf',
]

for font_path in font_paths:
    if os.path.exists(font_path):
        try:
            font = ImageFont.truetype(font_path, font_size)
            print(f"Using font: {font_path}")
            break
        except:
            continue

# If no bold font found, try to load default and make it bold by drawing multiple times
if font is None:
    try:
        # Try to get a larger default font
        font = ImageFont.load_default()
        font_size = min(width, height) // 2
        print("Using default font (will be made bold)")
    except:
        font = None
        font_size = min(width, height) // 2

# Get text bounding box to center it
if font:
    try:
        # Newer PIL versions
        bbox = draw.textbbox((0, 0), "S", font=font)
        text_width = bbox[2] - bbox[0]
        text_height = bbox[3] - bbox[1]
    except AttributeError:
        try:
            # Older PIL versions
            text_width, text_height = draw.textsize("S", font=font)
        except:
            text_width = width // 3
            text_height = height // 3
else:
    text_width = width // 3
    text_height = height // 3

# Center the text
x = (width - text_width) // 2
y = (height - text_height) // 2

# Draw the letter "S" in black - draw multiple times to make it bolder if needed
if font and 'Bold' not in str(font):
    # Make it bold by drawing multiple times with slight offsets
    offsets = [(-1, -1), (-1, 0), (-1, 1), (0, -1), (0, 0), (0, 1), (1, -1), (1, 0), (1, 1)]
    for dx, dy in offsets:
        draw.text((x + dx, y + dy), "S", fill=0, font=font)
else:
    # Draw once (bold font) or multiple times for thickness
    draw.text((x, y), "S", fill=0, font=font)
    if font and 'Bold' not in str(font):
        # Draw again slightly offset for thickness
        draw.text((x + 1, y + 1), "S", fill=0, font=font)

# Convert to numpy array and normalize to [0, 1]
s_array = np.array(s_image, dtype=np.float32) / 255.0

# Step 3: Create the masked estimate
# Create binary mask (where S is black, i.e., < 0.5)
threshold = 0.5
s_mask = s_array < threshold

# Apply mask: where S is black, remove stipples (set to white)
masked_stipple = stipple_array.copy()
masked_stipple[s_mask] = 1.0  # Set to white where mask is True

# Step 4: Assemble the four-panel meme
fig, axes = plt.subplots(1, 4, figsize=(16, 4))
fig.patch.set_facecolor('#FFE5E5')  # Light pink background

panels = [
    (original_array, "Reality"),
    (stipple_array, "Your Model"),
    (s_array, "Selection Bias"),
    (masked_stipple, "Estimate")
]

print(f"\nGenerating four-panel meme:")
print(f"  - Panel 1: Reality ({original_array.shape})")
print(f"  - Panel 2: Your Model ({stipple_array.shape})")
print(f"  - Panel 3: Selection Bias ({s_array.shape})")
print(f"  - Panel 4: Estimate ({masked_stipple.shape})")

for ax, (panel_data, title) in zip(axes, panels):
    ax.imshow(panel_data, cmap='gray', vmin=0, vmax=1)
    ax.set_title(title, fontsize=14, fontweight='bold', pad=10)
    ax.axis('off')

plt.tight_layout()
plt.subplots_adjust(wspace=0, hspace=0, left=0.02, right=0.98, top=0.9, bottom=0.1)

# Save the meme
plt.savefig('statistics_meme_result.png', dpi=200, bbox_inches='tight', facecolor='#FFE5E5')
print("Meme saved as 'statistics_meme_result.png'")
plt.show()
```

## Understanding Selection Bias Through Visualization

This four-panel meme demonstrates the concept of **selection bias** in statistics through a visual metaphor that makes abstract statistical concepts tangible and memorable.

### The Four Panels Explained

1. **Reality** (Panel 1): This represents the **true population**â€”your original image showing the complete, unbiased truth. In statistical terms, this is the full population we want to understand. Every detail is present, nothing is missing. This is what we're trying to estimate or learn about through our data collection.

2. **Your Model** (Panel 2): This is your **stippled representation**â€”a model of reality created through systematic sampling using blue noise stippling. The black dots represent your **data points** or observations. While this simplified representation captures the essential structure and visual information, it's a **sample** of the full population. In real research, this would be your collected datasetâ€”a subset of the population that you hope is representative.

3. **Selection Bias** (Panel 3): The bold letter "S" represents a **systematic pattern of missing data**. In real-world scenarios, selection bias occurs when certain groups, regions, or types of observations are systematically excluded from your sample. The "S" shape visually demonstrates this systematic exclusionâ€”it's not random missing data, but a **patterned absence** that follows a specific structure. This could represent:
   - Geographic bias (certain regions not sampled)
   - Demographic bias (certain groups excluded)
   - Temporal bias (certain time periods missing)
   - Response bias (certain types of responses not collected)

4. **Estimate** (Panel 4): This is what you'd see if selection bias affected your modelâ€”the **biased estimate** based on incomplete data. Notice how the "S"-shaped region has no data pointsâ€”the stipples have been removed, creating a "hole" in your data. If you tried to understand the full image using only this biased sample, you would miss critical information in the "S" region. This biased sample would lead to **incorrect conclusions** because it doesn't represent the full population.

### Why This Matters in Real Statistics

**Selection bias** is one of the most common and dangerous problems in data analysis. It occurs when the process of selecting observations for your sample is not random, leading to a sample that doesn't accurately represent the population of interest.

**Real-World Examples:**
- **Medical Research**: If a study only includes patients who can travel to a research center, it may miss rural populations, creating geographic selection bias.
- **Survey Research**: If an online survey excludes people without internet access, it creates a demographic selection bias.
- **Historical Data**: If records from certain time periods are missing, it creates temporal selection bias.

**The Key Insight:** When selection bias occurs, your sample (the stippled dots) doesn't match your population of interest (the original image). The missing data in the "S" shape creates a **distorted view of reality**, just like how biased sampling in research can lead to incorrect statistical conclusions, invalidated studies, and misleading policy decisions.

### The Visual Metaphor

This visualization serves as a **mental anchor**: whenever you encounter data analysis, ask yourself: **"Does my sample match my population of interest?"** 

- If your sample systematically excludes certain groups or regions (like the "S" excludes data points), you have selection bias.
- If your sample is representative (like the stippled image without the "S" mask), you can make valid inferences.
- The "S" shape makes the bias **visible**â€”you can literally see what's missing, making it easier to recognize and address in real-world scenarios.

This visualization will stick with you, making it easier to recognize and address selection bias in real-world data analysis throughout your career.
